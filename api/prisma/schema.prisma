generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ExperienceLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum Goal {
  WEIGHT_LOSS
  MUSCLE_GAIN
  ENDURANCE
  MAINTENANCE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum ProgramStatus {
  ACTIVE      // Programme actuellement suivi par l'utilisateur
  COMPLETED   // Programme terminé
  ARCHIVED    // Programme archivé, non actif mais conservé pour l'historique
  DRAFT       // Programme créé mais pas encore commencé (par ex. généré par l'IA)
}


model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  refreshToken String? 
  fitnessProfiles FitnessProfile[]
  exercicesCreated Exercice[]  @relation("ExerciceCreatedBy")
}

model FitnessProfile {
  id          Int      @id @default(autoincrement())
  userId     Int
  age        Int
  height    Float
  weight    Float
  trainingFrequency Int
  experienceLevel ExperienceLevel
  goals      Goal[]
  gender    Gender
  gym       Boolean
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  weightHistory WeightHistory[]
  trainingPrograms TrainingProgram[]

  user      User     @relation(fields: [userId], references: [id])
}


model WeightHistory {
  id          Int      @id @default(autoincrement())
  fitnessProfileId Int
  weight      Float
  date        DateTime @default(now())

  fitnessProfile FitnessProfile @relation(fields: [fitnessProfileId], references: [id], onDelete: Cascade)
}


model TrainingProgram {
  id          Int      @id @default(autoincrement())
  fitnessProfileId   Int
  name       String
  description String
  status     ProgramStatus @default(DRAFT)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  sessions   TrainingSession[]

  fitnessProfile FitnessProfile @relation(fields: [fitnessProfileId], references: [id], onDelete: Cascade)
}

model TrainingSession {
  id          Int      @id @default(autoincrement())
  programId   Int
  date       DateTime
  duration   Int?    
  notes      String?
  exercices   ExerciceSession[]

  trainingProgram TrainingProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
}


model Exercice {
  id   Int             @id @default(autoincrement())
  name          String
  difficulty    Int
  description   String?
  isDefault   Boolean  @default(true)  // ← exercice officiel (accessible à tous)
  createdByUserId Int?                 // ← optionnel : null = exercice global
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @default(now()) @updatedAt

  groupes       ExerciceMuscleGroup[]
  trainingSession      ExerciceSession[]
  equipments    ExerciceEquipment[]
  createdBy   User?     @relation("ExerciceCreatedBy", fields: [createdByUserId], references: [id], onDelete: Cascade)

}

model ExerciceSession {
  id            Int      @id @default(autoincrement())
  sessionId     Int
  exerciceId    Int
  sets          Int
  reps          Int
  weight        Float?


  trainingSession TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  exercice        Exercice        @relation(fields: [exerciceId], references: [id], onDelete: Cascade)
  performances   SetPerformance[]

  @@unique([sessionId, exerciceId])
}

model SetPerformance {
  id_set             Int             @id @default(autoincrement())
  id_exercice_session Int
  set_index          Int
  reps_effectuees    Int?
  reps_prevues       Int?
  weight             Float?
  rpe                Int?
  success           Boolean? @default(true)

  exerciceSession   ExerciceSession @relation(fields: [id_exercice_session], references: [id], onDelete: Cascade)
}

model ExerciceMuscleGroup {
  exerciceId    Int
  groupeId      Int

  exercice      Exercice       @relation(fields: [exerciceId], references: [id], onDelete: Cascade)
  groupe       MuscleGroup    @relation(fields: [groupeId], references: [id], onDelete: Cascade)

  @@id([exerciceId, groupeId])
}


model MuscleGroup {
  id          Int      @id @default(autoincrement())
  name       String   @unique
  exercices  ExerciceMuscleGroup[]
}


model Equipment {
  id          Int      @id @default(autoincrement())
  name       String   @unique
  description String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  exercices  ExerciceEquipment[]
}


model ExerciceEquipment {
  exerciceId    Int
  equipmentId   Int

  exercice      Exercice   @relation(fields: [exerciceId], references: [id], onDelete: Cascade)
  equipment     Equipment  @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@id([exerciceId, equipmentId])
}